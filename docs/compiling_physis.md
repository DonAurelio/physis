Compiling Physis Programs
=========================

Translation
-----------

Physis source code can be translated to source code for different
types target platforms. The current version supports the following
targets:  

- ref: sequential CPU code written in C
- mpi: distributed memory code written in C and MPI
- cuda: single-GPU code written in CUDA
- mpi-cuda: distributed memory GPU code written in CUDA and MPI

To compile Physis code, use `physisc` command, which is located at
the <install-prefix>/bin directory, as follows:

    $ physisc --<target> test.c -I<install-prefix>/include
    
where `target` can be one of the supported platforms. More simply,
a utility shell script is provided for each platform, such as
`physisc-cuda`. So, the following translates test.c to cuda code:

     $ physisc-cuda test.c
     
The translated file is produced in the current working directory with its
name derived from the original file name and target. For example, in
the above case, a CUDA source file named `test.cuda.cu` will be
generated. 


Compilation
-----------

Source code generated by Physis is ordinary code written in each
target-dependent language with libraries. It can be compiled by the
standard compiler for each target, such as nvcc for CUDA. The
generated code uses header files under <install-prefix>/include, so
it must be given to the compile command as an include path.

Example: 

    $ nvcc test.cuda.cu -I<install-prefix>/include


Link
----

Just link with target-specific runtime libraries with other object
files. The runtime libraries are located at <install-prefix>/lib, with
the names as `libphysis_rt_<target>.a`. For example, the runtime for
CUDA is `libphysis_rt_cuda.a`. Note that the runtime libraries are
written in C++, so using the C++ compiler driver would simplify
the linking step. 

Example 1: Linking MPI code.

    $ mpicxx test.mpi.o <install-prefix>/lib/libphysis_rt_mpi.a

Example 2: Linking CUDA code.

    $ nvcc test.cuda.o <install-prefix>/lib/libphysis_rt_cuda.a
